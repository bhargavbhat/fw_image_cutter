# build command flags
CXX = g++
CXX_FLAGS = -Wall -Wextra -Wpedantic -Werror --std=c++11
INC_FLAGS = -I ./
TARGET = fw_image_cutter

# name of the bin file generated by toolchain (must be 512KiB in size)
FW_FILE_NAME = image.bin

# defines for lower section
LOWER_SECTION_ADDRESS = 0x20000
LOWER_SECTION_SIG = 0xA5A5
LOWER_SECTION_MAJOR_VER = 3
LOWER_SECTION_MINOR_VER = 0
LOWER_SECTION_NAME = fota_lower.bin

# defines for upper section
UPPER_SECTION_ADDRESS = 0x50000
UPPER_SECTION_SIG = 0xC9C9
UPPER_SECTION_MAJOR_VER = 2
UPPER_SECTION_MINOR_VER = 1
UPPER_SECTION_NAME = fota_upper.bin

# size of section in bytes (currently 160KiB)
SECTION_SIZE = 0x28000

# generated binaries
BUILD_GEN = *.o *.a *.obj

# make rules
all:
	@$(CXX) $(CXX_FLAGS) main.cpp -o $(TARGET) $(INC_FLAGS)

debug: CXX_FLAGS += -O0 -ggdb3
debug: all

lower:
	@rm -f $(LOWER_SECTION_NAME)
	@./$(TARGET) $(FW_FILE_NAME) $(LOWER_SECTION_ADDRESS) $(SECTION_SIZE) $(LOWER_SECTION_SIG)\
		$(LOWER_SECTION_MAJOR_VER) $(LOWER_SECTION_MINOR_VER) 1 $(LOWER_SECTION_NAME)
upper:
	@rm -f $(UPPER_SECTION_NAME)
	@./$(TARGET) $(FW_FILE_NAME) $(UPPER_SECTION_ADDRESS) $(SECTION_SIZE) $(UPPER_SECTION_SIG)\
		$(UPPER_SECTION_MAJOR_VER) $(UPPER_SECTION_MINOR_VER) 1 $(UPPER_SECTION_NAME)
lower_nometa:
	@rm -f meta_$(LOWER_SECTION_NAME)
	@./$(TARGET) $(FW_FILE_NAME) $(LOWER_SECTION_ADDRESS) $(SECTION_SIZE) $(LOWER_SECTION_SIG)\
		$(LOWER_SECTION_MAJOR_VER) $(LOWER_SECTION_MINOR_VER) 0 nometa_$(LOWER_SECTION_NAME)
upper_nometa:
	@rm -f meta_$(UPPER_SECTION_NAME)
	@./$(TARGET) $(FW_FILE_NAME) $(UPPER_SECTION_ADDRESS) $(SECTION_SIZE) $(UPPER_SECTION_SIG)\
		$(UPPER_SECTION_MAJOR_VER) $(UPPER_SECTION_MINOR_VER) 0 nometa_$(UPPER_SECTION_NAME)
clean: 
	@rm -f $(BUILD_GEN) $(TARGET)
	@rm -f $(LOWER_SECTION_NAME) nometa_$(LOWER_SECTION_NAME) $(UPPER_SECTION_NAME) nometa_$(UPPER_SECTION_NAME)
